job: account
datacenters: [ srnd ]

deployment:
  healthy_deadline: 5m

tasks:
  account:
    image: "codeday/account"

    resources:
      memory_limit: 512
      memory: 100

    vault:
      policies:
        - account
      env:
        account:
          APP_URL: APP_URL
          AUTH0_CLIENT_ID: AUTH0_CLIENT_ID
          AUTH0_CLIENT_SECRET: AUTH0_CLIENT_SECRET
          AUTH0_DOMAIN: AUTH0_DOMAIN
          AUTH0_MANAGEMENT_DOMAIN: AUTH0_MANAGEMENT_DOMAIN
          AUTH0_HOOK_SHARED_SECRET: AUTH0_HOOK_SHARED_SECRET

    ports:
      http:
        inner: 3000
        check:
          path: "/api/health"
        lb:
          sticky: true
          domain: account.codeday.org
          cert: codeday.org
          https_only: true
